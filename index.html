<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RespondentKey</title>
  <style>
    body{font-family:Arial, sans-serif; padding:16px; max-width:520px; margin:0 auto;}
    input,button{width:100%; font-size:20px; padding:12px; box-sizing:border-box;}
    button{margin-top:10px;}
    .hint{margin-top:10px; color:#555; font-size:14px; word-break:break-all;}
  </style>
</head>
<body>
  <h2>Введите RespondentKey</h2>

  <input id="rk" type="text" placeholder="XXXXX"
         autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false"
         inputmode="text">

  <button id="go">Открыть анкету</button>

  <div class="hint" id="preview"></div>

  <script>
    (function () {
      var PREFIX = "https://interviewingap.nfieldmr.com/Interviews/qrFl7/QBsH6aLsS2FUjEJMFXaP?RespondentKey=";
      var SUFFIX = "&pnl=CNT01&panelas=LFP01";

      var rk = document.getElementById("rk");
      var go = document.getElementById("go");
      var preview = document.getElementById("preview");

      try {
        var saved = localStorage.getItem("lastRespondentKey");
        if (saved) rk.value = saved;
      } catch (e) {}

      function buildUrl(key) {
        return PREFIX + encodeURIComponent(key) + SUFFIX;
      }

      function updatePreview() {
        var key = rk.value || "";
        preview.textContent = key ? ("Ссылка: " + buildUrl(key)) : "";
      }

      function openSurvey() {
        var key = (rk.value || "").replace(/^\s+|\s+$/g, "");
        if (!key) { rk.focus(); return; }

        try { localStorage.setItem("lastRespondentKey", key); } catch (e) {}
        window.location.href = buildUrl(key);
      }

      rk.onkeyup = function (e) {
        e = e || window.event;
        updatePreview();
        if (e.keyCode === 13) openSurvey(); // Enter
      };

      go.onclick = openSurvey;
      updatePreview();
      rk.focus();
      rk.select();
    })();
  </script>
</body>
</html>
